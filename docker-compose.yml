version: '3.8'

services:
  he-benchmark:
    build: .
    volumes:
      # Mount source files only, not the compiled libraries
      - ./src:/app/src
      - ./examples:/app/examples
      - ./cpp_wrapper:/app/cpp_wrapper
      - ./helib_wrapper:/app/helib_wrapper
      - ./openfhe_cpp_wrapper:/app/openfhe_cpp_wrapper
      - ./Cargo.toml:/app/Cargo.toml
      - ./Cargo.lock:/app/Cargo.lock
      - ./build.rs:/app/build.rs
      # Cache volumes
      - cargo-cache:/root/.cargo/registry
      - target-cache:/app/target
    working_dir: /app
    stdin_open: true
    tty: true
    environment:
      - RUST_BACKTRACE=1
      - LD_LIBRARY_PATH=/usr/local/lib:/usr/local/helib_pack/lib

volumes:
  cargo-cache:
  target-cache: